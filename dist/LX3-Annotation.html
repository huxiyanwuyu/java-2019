<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>注解 Annotation</title>
<link href="lib/css/app.css" rel="stylesheet"><link href="https:/use.fontawesome.com/releases/v5.2.0/css/all.css" rel="stylesheet"><link href="lib/css/ttf.css" rel="stylesheet"></head>

<body>

    <div class="reveal">
        <div class="slides">

            <section class="title-slide">
                <div class="huge framed bordered border-3x font-passionone bg-warning-alpha-08">
                    注解 Annotation
                </div>
            </section>


            <section>
                <div class="down-3">
                    <h2>注解</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li class="big">
                            从JavaSE 1.5开始，Java增加了对元数据的支持，也就是Annotation。
                            <ul class="down-3">
                                <li>
                                    元数据是关于数据的数据。在编程语言上下文中，元数据是添加到程序元素如方法、字段、类和包上的额外信息，对数据进行说明描述的数据
                                </li>
                            </ul>
                        </li>
                        <li class="down-3 big">
                            Annotation其实就是对代码的一种特殊标记，这些标记可以在编译，类加载和运行时被读取，并执行相应的处理。
                        </li>
                    </ul>
                </div>

            </section>

            <section>
                <div class="down-3">
                    <h2>你已经见过</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li class="down-3 big">
                            <code>@Override</code> — 限定重写父类方法
                        </li>
                        <li class="down-3 big">
                            <code>@Deprecated</code> — 标示已过时
                        </li>
                        <li class="down-3 big">
                            <code>@SuppressWarning</code> — 抑制编译器警告
                        </li>
                </div>
            </section>

            <section>

                <div class="down-3">
                    <h2><code>@Override</code></h2>
                </div>


                <div class="down-9">
                    <ul>
                        <li class="down-3 big">
                            用于告知编译器，需要覆写父类的当前方法
                        </li>
                        <li class="down-3 big">
                            如果某个方法带有该注解但并没有覆写父类相应的方法，则编译器会生成一条错误信息
                        </li>
                        <li class="down-3 big">
                            <code>@Override</code>可适用元素为方法
                        </li>
                </div>
            </section>

            <section>

                <div class="down-3">
                    <h2><code>@Deprecated</code></h2>
                </div>


                <div class="down-9">
                    <ul>
                        <li class="down-3 big">
                            使用这个注解，用于告知编译器，某一程序元素(比如方法，成员变量)不建议使用了（即过时了）
                        </li>
                        <li class="down-3 big">
                            调用具有该注解的方法时编译器会出现警告，告知该方法已过时。
                        </li>
                        <li class="down-3 big">
                            <code>@Deprecated</code>可适合用于除注解类型声明之外的所有元素
                        </li>
                </div>
            </section>

            <section>

                <div class="down-3">
                    <h2><code>@SuppressWarnings</code></h2>
                </div>


                <div class="down-9">
                    <ul>
                        <li class="down-3 big">
                            用于告知编译器忽略特定的警告信息
                        </li>
                        <li class="down-3 big">
                            例在泛型中使用原生数据类型，编译器会发出警告，当使用该注解后，则不会发出警告 </li>
                        <li class="down-3 big">该注解有方法value(）属性,可支持多个字符串参数，用户指定忽略哪种警告 </li>
                        <ul>
                            <li> <code>@SupressWarning(value={"uncheck","deprecation"})</code>
                            </li>
                        </ul>
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2><code>value</code></h2>
                </div>
                <div class="small down-5">
                    <table>
                        <thead>
                            <tr>
                                <th>参数</th>
                                <th>含义</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>deprecation</code></td>
                                <td>使用了过时的类或方法</td>
                            </tr>
                            <tr>
                                <td><code>unchecked</code></td>
                                <td>执行了未检查的转换</td>
                            </tr>
                            <tr>
                                <td><code>fallthrough</code></td>
                                <td>switch块缺少了break</td>
                            </tr>
                            <tr>
                                <td><code>fianlly</code></td>
                                <td>任意finally子句不能正常完成</td>
                            </tr>
                            <tr>
                                <td><code>... </code></td>
                                <td>... </td>
                            </tr>
                            <tr>
                                <td><code>all</code></td>
                                <td>以上所有情况</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="down-5 fragment center danger"><code>javac -X</code></div>
            </section>


            <section>
                <div class="down-3">
                    <h2>元注解 Meta-Annotation</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li class="big">
                            Meta-Annotation就是修饰其他Annotation的Annotation
                        </li>
                        <li class="down-3 big">
                            Java除了在<code>java.lang</code>提供了上述内建注解外，还在<code>java.lang.annotation</code>包下提供了6个Meta-Annotation

                            <ul class="down-3">
                                <li>
                                    其中有5个元注解都用于修饰其他的Annotation定义，<code>@Repeatable</code>专门用户定义Java 8新增的可重复注解
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>

            </section>

            <section>
                <div class="down-3">
                    <h2> 看个实例 </h2>
                </div>
                <div class="down-5">
                    <code> Annotation Type Override </code>

                </div>
                <div class="down-3">
                    <pre class="java">
                            <code data-trim>
                                @Target(value=METHOD)
                                @Retention(value=SOURCE)
                                public @interface Override {

                                }
                            </code>
                            
                        </pre>
                </div>
                <div class="small">
                    其中<code>@interface</code>定义了<code>Override</code>是一个Annotation类型，或者叫元数据(meta-data)。
                </div>
                <div class="small">
                    <code>@Target</code>和<code>@Retetion</code>是对<code>Override</code>的注解，称之为元注解(注解的注解)。

                </div>

                <div class="down-3 center tiny">https://docs.oracle.com/javase/7/docs/api/java/lang/Override.html</div>

            </section>

            <section>
                <div class="down-3">
                    <h2><code>@Target</code>的定义</h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                        <code data-trim> 
                            package java.lang.annotation;
                            @Documented
                            @Retention(RetentionPolicy.RUNTIME)
                            @Target(ElementType.ANNOTATION_TYPE)
                            public @interface Target {
                                /**
                                * Returns an array of the kinds of elements an annotation type
                                * can be applied to.
                                * @return an array of the kinds of elements an annotation type
                                * can be applied to
                                */
                                ElementType[] value();
                            }
                        </code>
                        
                    </pre>
                </div>
                <div class="down-1 small center"><code>Target</code>也是一个注解类型，在其内部定义了方法<code>ElementType[]
                        value();</code>返回值就是<code>@Target(ElementType.METHOD)</code>中的<code>ElementType.METHOD</code>，也就是注解的属性，是一个<code>ElementType</code>枚举</code>
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2><code>ElementType</code></h2>
                </div>
                <div class="down-3">
                    <pre class="java tiny">
                                    <code data-trim>
                                        package java.lang.annotation;
                                        public enum ElementType {
                                            /** Class, interface (including annotation type), or enum declaration */
                                            TYPE,
                                            /** Field declaration (includes enum constants) */
                                            FIELD,
                                            /** Method declaration */
                                            METHOD,
                                            /** Formal parameter declaration */
                                            PARAMETER,
                                            /** Constructor declaration */
                                            CONSTRUCTOR,
                                            /** Local variable declaration */
                                            LOCAL_VARIABLE,
                                            /** Annotation type declaration */
                                            ANNOTATION_TYPE,
                                            /** Package declaration */
                                            PACKAGE,
                                            /** Type parameter declaration */
                                            TYPE_PARAMETER,
                                            /** Use of a type */
                                            TYPE_USE
                                        }
                                    </code>
                                    
                                </pre>
                </div>

                <div class="down-1 center small">
                    这个枚举其实就是定义了注解的适用范围，在<code>Override</code>注解中，<code>@Target</code>的属性是<code>ElementType.METHOD</code>,所以<code>Override</code>这个注解只能用于注解方法。
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>再看<code>@Target</code></h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                        <code data-trim>
                            package java.lang.annotation;
                            @Documented
                            @Retention(RetentionPolicy.RUNTIME)
                            @Target(ElementType.ANNOTATION_TYPE)
                            public @interface Target {
                                /**
                                * Returns an array of the kinds of elements an annotation type
                                * can be applied to.
                                * @return an array of the kinds of elements an annotation type
                                * can be applied to
                                */
                                ElementType[] value();
                            }
                        </code>
                        
                    </pre>
                </div>

                <div class="down-1  center">
                    <code>Target</code>注解本身也有一个<code>@Target</code>注解，这个<code>@Target</code>注解属性是<code>ElementType.ANNOTATION_TYPE</code>，也就是说<code>Target</code>注解只能用作元数据(注解)的注解，所以叫它元注解。
                </div>

                <div class="down-1 center"><code>@Retention(RetentionPolicy.RUNTIME)</code>? <code>@Documented</code>?
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2><code>@Retention</code></h2>
                </div>
                <div class="row down-3">
                    <div class="col-50">
                        <pre class="java">
                        <code data-trim>
                            package java.lang.annotation;
                            @Documented
                            @Retention(RetentionPolicy.RUNTIME)
                            @Target(ElementType.ANNOTATION_TYPE)
                            public @interface Retention {
                                /**
                                * Returns the retention policy.
                                * @return the retention policy
                                */
                                RetentionPolicy value();
                            }

                            
                        </code>
                        
                    </pre>
                    </div>
                    <div class="col-50">
                        <pre class="java tiny">
                        <code data-trim>
                            public enum RetentionPolicy {
                                /**
                                * Annotations are to be discarded by the compiler.
                                */
                                SOURCE,

                                /**
                                * Annotations are to be recorded in the class file by the compiler
                                * but need not be retained by the VM at run time.  This is the default
                                * behavior.
                                */
                                CLASS,

                                /**
                                * Annotations are to be recorded in the class file by the compiler and
                                * retained by the VM at run time, so they may be read reflectively.
                                *
                                * @see java.lang.reflect.AnnotatedElement
                                */
                                RUNTIME
                            }
                            </code>
                                        
                        </pre>
                    </div>
                </div>

                <div class="down-1  center small">
                    <code>@Retention</code>注解则定义了注解的保留范围，如:在源代码、CLASS文件或运行时保留。超出<code>@Retention</code>定义的属性，注解将被丢弃。
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2><code>@Documented</code></h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                            <code data-trim>
                                    package java.lang.annotation;
                                    @Documented
                                    @Retention(RetentionPolicy.RUNTIME)
                                    @Target(ElementType.ANNOTATION_TYPE)
                                    public @interface Documented {

                                    }
                            </code>
                            
                        </pre>
                </div>

                <div class="down-1  center small">
                    如果一个注解定义了<code>@Ducumented</code>，在<a
                        href="http://www.oracle.com/technetwork/articles/java/index-137868.html">javadoc</a>)生成API文档时，被这个注解标记的元素在文档上也会出现该注解。
                </div>

            </section>
            <section>
                <div class="down-3">
                    <h2><code>@Inherited</code></h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                        <code data-trim>
                                @Documented
                                @Retention(RetentionPolicy.RUNTIME)
                                @Target(ElementType.ANNOTATION_TYPE)
                                public @interface Inherited {

                                }
                        </code>
                    </pre>
                </div>

                <div class="down-1  center small">
                    只对<code>@Target</code>为<code>ElementType.TYPE</code>(类、接口、枚举)有效，并且只支持类元素。使用了<code>@Inherited</code>的注解修饰在一个class上，可以保证继承它的子类也拥有同样的注解。
                </div>

            </section>
            <section>
                <div class="down-3">
                    <h2>自定义注解</h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                            <code data-trim>
                                    @Documented
                                    @Target(ElementType.METHOD)
                                    @Inherited
                                    @Retention(RetentionPolicy.RUNTIME)
                                    public @interface AuthorAnno{
                                        //以下无参方法实际上定义的是注解的属性
                                        //其返回值可以是所有基本类型、String、Class、enum、Annotation或以上类型的数组
                                        String name();
                                        //default关键字可以定义该属性的默认值，如果没有指定默认值在使用注解时必须显示指定属性值
                                        String website() default "hello";
                                        int revision() default 1;
                                    }
                            </code>
                        </pre>
                </div>

            </section>

            <section>
                <div class="down-3">
                    <h2> 使用自定义注解 </h2>
                </div>
                <div class="down-1">
                    <pre class="java">
                        <code data-trim>
                                public class AnnotationDemo {
                                    @AuthorAnno(name="lvr", website="hello", revision=1)
                                    public static void main(String[] args) {
                                        System.out.println("I am main method");
                                    }
                                
                                    @SuppressWarnings({ "unchecked", "deprecation" })
                                    @AuthorAnno(name="lvr", website="hello", revision=2)
                                    public void demo(){
                                        System.out.println("I am demo method");
                                    }
                                }
                        </code>                 
                    </pre>
                </div>

            </section>


            <section>
                    <div class="down-3">
                        <h2>注解解析</h2>
                    </div>
                    <div class="down-1">
                        <pre class="java">
                            <code data-trim>
                                    public class AnnotationParser {
                                        public static void main(String[] args) throws SecurityException, ClassNotFoundException {
                                            String clazz = "AnnotationDemo";
                                            Method[]  demoMethod = AnnotationParser.class.getClassLoader().loadClass(clazz).getMethods();
                                    
                                            for (Method method : demoMethod) {
                                                if (method.isAnnotationPresent(AuthorAnno.class)) {
                                                     AuthorAnno annotationInfo = method.getAnnotation(AuthorAnno.class);
                                                     System.out.println("method: "+ method);
                                                     System.out.println("name= "+ annotationInfo.name() +
                                                             " , website= "+ annotationInfo.website()
                                                            + " , revision= "+annotationInfo.revision());
                                                }
                                            }
                                        }
                                    }
                            </code>                 
                        </pre>
                    </div>
    
                </section>

            <section>
                <div class="down-30 center larger">
                    为葫芦娃配上注解！
                </div>
            </section>
        </div>
    </div>
<script type="text/javascript" src="lib/js/app.js"></script></body>
</head>

</html>